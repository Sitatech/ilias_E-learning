function cleanElements(b){var a=YAHOO.util.Dom.getElementsBy(function(c){return(c.type=="text")?true:false},"input",b);for(i=0;i<a.length;i++){a[i].value=""}}function reindexRows(b,a){var c=YAHOO.util.Dom.getElementsBy(function(d){return true},"tr",b);for(i=0;i<c.length;i++){YAHOO.util.Dom.removeClass(c[i],"odd");YAHOO.util.Dom.removeClass(c[i],"even");YAHOO.util.Dom.removeClass(c[i],"first");YAHOO.util.Dom.removeClass(c[i],"last");alter=(i%2==0)?"even":"odd";YAHOO.util.Dom.addClass(c[i],alter);add=(i==0)?"first":((i==c.length-1)?"last":"");if(add.length>0){YAHOO.util.Dom.addClass(c[i],add)}textinputs=YAHOO.util.Dom.getElementsBy(function(d){return(d.type=="text")?true:false},"input",c[i]);for(j=0;j<textinputs.length;j++){if(textinputs[j].id.indexOf("[key]")>=0){textinputs[j].id=a+"[key]["+i+"]";textinputs[j].name=a+"[key]["+i+"]"}else{if(textinputs[j].id.indexOf("[value]")>=0){textinputs[j].id=a+"[value]["+i+"]";textinputs[j].name=a+"[value]["+i+"]"}}}addbuttons=YAHOO.util.Dom.getElementsBy(function(d){return(d.className=="kvp_add")?true:false},"input",c[i]);for(j=0;j<addbuttons.length;j++){addbuttons[j].id="add_"+a+"["+i+"]";addbuttons[j].name="cmd[add"+a+"]["+i+"]";YAHOO.util.Event.addListener(addbuttons[j],"click",addRow)}removebuttons=YAHOO.util.Dom.getElementsBy(function(d){return(d.className=="kvp_remove")?true:false},"input",c[i]);for(j=0;j<removebuttons.length;j++){removebuttons[j].id="remove_"+a+"["+i+"]";removebuttons[j].name="cmd[remove"+a+"]["+i+"]";YAHOO.util.Event.addListener(removebuttons[j],"click",removeRow)}upbuttons=YAHOO.util.Dom.getElementsBy(function(d){return(d.className=="kvp_up")?true:false},"input",c[i]);if(upbuttons.length>0){for(j=0;j<upbuttons.length;j++){upbuttons[j].id="up_"+a+"["+i+"]";upbuttons[j].name="cmd[up"+a+"]["+i+"]";YAHOO.util.Event.addListener(upbuttons[j],"click",moveRowUp)}}downbuttons=YAHOO.util.Dom.getElementsBy(function(d){return(d.className=="kvp_down")?true:false},"input",c[i]);if(downbuttons.length>0){for(j=0;j<downbuttons.length;j++){downbuttons[j].id="down_"+a+"["+i+"]";downbuttons[j].name="cmd[down"+a+"]["+i+"]";YAHOO.util.Event.addListener(downbuttons[j],"click",moveRowDown)}}}}function removeListeners(d){var a=YAHOO.util.Dom.getElementsBy(function(f){return(f.className=="kvp_add")?true:false},"input",d);for(i=0;i<a.length;i++){YAHOO.util.Event.purgeElement(a[i])}var c=YAHOO.util.Dom.getElementsBy(function(f){return(f.className=="kvp_remove")?true:false},"input",d);for(i=0;i<c.length;i++){YAHOO.util.Event.purgeElement(c[i])}var b=YAHOO.util.Dom.getElementsBy(function(f){return(f.className=="kvp_up")?true:false},"input",d);for(i=0;i<b.length;i++){YAHOO.util.Event.purgeElement(b[i])}var e=YAHOO.util.Dom.getElementsBy(function(f){return(f.className=="kvp_down")?true:false},"input",d);for(i=0;i<e.length;i++){YAHOO.util.Event.purgeElement(e[i])}}function addRow(c,b){var d=this.parentNode.parentNode;var a=d.parentNode;removeListeners(a);rowclone=d.cloneNode(true);cleanElements(rowclone);trs=YAHOO.util.Dom.getElementsBy(function(e){return true},"tr",a);parentindex=0;for(i=0;i<trs.length;i++){if(trs[i]==d){parentindex=i+1}}if(parentindex==trs.length){a.appendChild(rowclone)}else{a.insertBefore(rowclone,trs[parentindex])}reindexRows(a,a.parentNode.parentNode.id);textinputs=YAHOO.util.Dom.getElementsBy(function(e){return(e.type=="text")?true:false},"input",rowclone);textinputs[0].focus();return false}function removeRow(c,b){var d=this.parentNode.parentNode;var a=d.parentNode;trs=YAHOO.util.Dom.getElementsBy(function(e){return true},"tr",a);if(trs.length==1){cleanElements(trs[0])}else{a.removeChild(d);removeListeners(a);reindexRows(a,a.parentNode.parentNode.id)}}function moveRowUp(c,b){var d=this.parentNode.parentNode;var a=d.parentNode;rows=YAHOO.util.Dom.getElementsBy(function(e){return true},"tr",a);foundindex=0;for(i=0;i<rows.length;i++){if(rows[i]==d){foundindex=i}}if(foundindex>0){removeListeners(a);temp=rows[foundindex-1];rows[foundindex-1]=d;rows[foundindex]=temp;children=a.childNodes;for(j=0;j<children.length;j++){a.removeChild(children[j])}for(j=0;j<rows.length;j++){a.appendChild(rows[j])}reindexRows(a,a.parentNode.parentNode.id)}}function moveRowDown(c,b){var d=this.parentNode.parentNode;var a=d.parentNode;rows=YAHOO.util.Dom.getElementsBy(function(e){return true},"tr",a);foundindex=0;for(i=0;i<rows.length;i++){if(rows[i]==d){foundindex=i}}if(foundindex<rows.length-1){removeListeners(a);temp=rows[foundindex+1];rows[foundindex+1]=d;rows[foundindex]=temp;children=a.childNodes;for(j=0;j<children.length;j++){a.removeChild(children[j])}for(j=0;j<rows.length;j++){a.appendChild(rows[j])}reindexRows(a,a.parentNode.parentNode.id)}}function kvpWizardEvents(a){addbuttons=YAHOO.util.Dom.getElementsByClassName("kvp_add");for(i=0;i<addbuttons.length;i++){button=addbuttons[i];YAHOO.util.Event.addListener(button,"click",addRow)}removebuttons=YAHOO.util.Dom.getElementsByClassName("kvp_remove");for(i=0;i<removebuttons.length;i++){button=removebuttons[i];YAHOO.util.Event.addListener(button,"click",removeRow)}upbuttons=YAHOO.util.Dom.getElementsByClassName("kvp_up");for(i=0;i<upbuttons.length;i++){button=upbuttons[i];YAHOO.util.Event.addListener(button,"click",moveRowUp)}downbuttons=YAHOO.util.Dom.getElementsByClassName("kvp_down");for(i=0;i<downbuttons.length;i++){button=downbuttons[i];YAHOO.util.Event.addListener(button,"click",moveRowDown)}}YAHOO.util.Event.onDOMReady(kvpWizardEvents);